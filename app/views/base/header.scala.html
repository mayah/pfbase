@(doesShowMessage: Boolean = true)(implicit context: controllers.ActionContext)
<div class="navbar navbar-fixed-top navbar-inverse">
    <div class="navbar-inner">
        <div class="container">
            <a class="brand" href="/">BASE</a>
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <div class="nav-collapse">
            <ul class="nav">
                <li><a href="#">メニュー１</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">メニュー２ <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">メニュー 2-1</a></li>
                        <li><a href="#">メニュー 2-2</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li class="dropdown hidden-phone">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        About
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#">よくある質問</a></li>
                        <li><a href="#">ご要望・バグ報告</a></li>
                        <li class="divider"></li>
                        <li><a href="#">お問い合わせ</a></li>
                        <li><a href="#">利用規約</a></li>
                        <li class="divider"></li>
                        <li><a href="https://github.com/mayah/">Copyright &copy; MAYAH</a></li>
                    </ul>
                </li>
            @defining(context.maybeLoginUser) { loginUser => @loginUser match {
                case None => {
                <li class="dropdown" data-dropdown onclick="setTimeout(function() { $('#input-email').focus() }, 0);">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">ログイン <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><div class="item"><div class="row"><div class="span8"><form id="login-form" class="no-margin">
                        	<div class="control-group no-margin">
     							<input id="login-email" type="email" class="span8" placeholder="メールアドレス">
     							<span id="login-email-help" class="help-block hidden"></span>
	    					</div>
                        	<div class="control-group no-margin">
                        		<input id="login-password" type="password" class="span8" placeholder="パスワード">
                        		<span id="login-password-help" class="help-block hidden"></span>
							</div>
							<div class="control-group no-margin"><div class="row">
								<label class="checkbox span4"><input id="login-rememberme" type="checkbox"> Remember me</label>
								<input id="login-submit" type="submit" value="ログイン" class="btn btn-info span3 pull-right">
						    </div></div>
                        </form></div></div><div></li>
                        <li class="divider"></li>
                        <li><a href="#" onclick="document.loginByTwitterForm.submit();">Twitter でログイン</a>
                        <form name="loginByTwitterForm" action="/auth/loginByTwitter" style="display:none">
                            <input type="hidden" name="redirectURL" value="@context.maybeRedirectURL.getOrElse("")" />
                        </form></li>
                    </ul>
                    <script>
                        $(document).ready(function() {
                        	$('#login-form').submit(function() {
	                        	var args = {
	                        		email: $('#login-email').val().trim(),
	                        		password: $('#login-password').val().trim(),
	                        		rememberme: $('#login-rememberme').val().trim(),
	                        		sessionToken: "@context.sessionToken"
	                        	};

								$('#login-submit').attr('disabled', 'disabled');
								$.post('/api/auth/login', args).done(function(json) {
									console.log(json);
									@defining(context.maybeRedirectURL) { redirectURL => @redirectURL match {
										case None => { location.href = '/'; }
										case Some(x) => { localtion.href = '@x'; }
									}}
								}).fail(function(xhr) {
									$('#login-submit').removeAttr('disabled');
									var json = $.parseJSON(xhr.responseText);
									if (json['optionalInfo'] && json['optionalInfo']['password']) {
										$('#login-password-help').text(json['optionalInfo']['password']).removeClass('hidden');
									}
									console.log(json);
								});

								return false;
                        	});
                        });
                    </script>
                </li>
                }

                case Some(loginUser) => {
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        @loginUser.name
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="/mypage">マイページ</a></li>
                        <li class="divider"></li>
                        <li><a href="/auth/logout">ログアウト</a></li>
                    </ul>
                </li>
                }
            }}
            </ul>
            </div>
        </div>
    </div>
</div>

@if(doesShowMessage && context.hasSomeMessages) {
<div class="container"><div class="message">
    @for(messageCode <- context.messageCodes) {
        <div class="alert alert-info fade in">
            <a class="close" data-dismiss="alert" href="#">&times;</a>
            @messageCode.description
        </div>
    }
    @for(userErrorCode <- context.userErrorCodes) {
        <div class="alert alert-warning fade in">
            <a class="close" data-dismiss="alert" href="#">&times;</a>
            @userErrorCode.description
        </div>
    }
    @for(serverErrorCode <- context.serverErrorCodes) {
        <div class="alert alert-error fade in">
            <a class="close" data-dismiss="alert" href="#">&times;</a>
            @serverErrorCode.description
        </div>
    }
</div></div>
}
